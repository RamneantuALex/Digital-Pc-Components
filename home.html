<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Page</title>
    <link rel="stylesheet" href="./style.css">
    <script src="https://unpkg.com/htmx.org@1.7.0"></script>
</head>
<body>
<nav>
    <div id="nav-div">
        <button onclick="window.location.href='produse_crud.html'">Product List</button>
        <div id="account-name">
            <p id="userName">Account Name</p>
            <div id="popup-menu">
                <button onclick="window.location.href='page1.html'">Page 1</button>
                <div id="role-div">
                    <button id="managerButton" onclick="window.location.href='manager_page.html'">Manager</button>
                    <button id="juniorButton" onclick="window.location.href='junior.html'">Junior</button>
                    <button id="seniorButton" onclick="window.location.href='senior.html'">Senior</button>
                </div>
                <button id="basketButton" onclick="window.location.href='basket.html'">Basket</button>
                <button onclick="window.location.href='login.html'">Login</button>
            </div>
        </div>
    </div>
</nav>

<header>
    <h1>Welcome to Our Electronic System Store</h1>
</header>

<main>
    <section>
        <h2>About Us</h2>
        <p>Information about the store...</p>
    </section>

    <input type="text" id="userId" placeholder="Enter user ID">
    <button id="fetchUserButton">Fetch User</button>

    <script>
        document.getElementById('account-name').addEventListener('click', function() {
            var popupMenu = document.getElementById('popup-menu');
            popupMenu.style.display = popupMenu.style.display === 'none' ? 'block' : 'none';
        });


        window.onload = function() {
            var urlParams = new URLSearchParams(window.location.search);
            var userId = urlParams.get('userId');

            if (userId === null) {
                document.getElementById('userId').value = '';
            } else {
                document.getElementById('userId').value = userId;
            }
            document.getElementById('managerButton').style.display = 'none';
            document.getElementById('juniorButton').style.display = 'none';
            document.getElementById('seniorButton').style.display = 'none';

            // Fetch the user details
            fetch('http://localhost:8081/user/' + userId)
                .then(response => response.json())
                .then(user => {
                    document.getElementById('managerButton').style.display = user.role === 'MANAGER' ? 'block' : 'none';
                    document.getElementById('juniorButton').style.display = user.role === 'JUNIOR_SWE' ? 'block' : 'none';
                    document.getElementById('seniorButton').style.display = user.role === 'SENIOR_SWE' ? 'block' : 'none';

                    var userName = user.firstName && user.lastName ? user.firstName + ' ' + user.lastName : 'Account Name';
                    document.getElementById('userName').textContent = userName;
                })
                .catch((error) => {
                    console.error('Error:', error);
                    document.getElementById('userName').textContent = 'Account Name';
                });
        };

    </script>

    <footer>
        <p>Copyright &copy; 2024 Electronic System Store</p>
    </footer>
</main>
</body>
</html>